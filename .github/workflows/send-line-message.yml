name: LINE Water Check Notification

on:
  schedule:
    - cron: '0 0 * * *'  # JST 9:00 ã«å®Ÿè¡Œï¼ˆUTC 0:00ï¼‰
  workflow_dispatch:

jobs:
  notify-if-no-water:
    runs-on: ubuntu-latest
    steps:
      - name: Check data.json and notify LINE
        env:
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
          LINE_GROUP_ID: ${{ secrets.LINE_GROUP_ID }}
        run: |
          echo "â–¶ é–‹å§‹ï¼šdata.json ã‚’ç¢ºèª"

          RESPONSE=$(curl -s https://miyakozuka-89982.web.app/data.json)

          echo "ğŸ§¾ å–å¾—ã—ãŸ JSON:"
          echo "$RESPONSE" | jq .

          HAS_TIME1=$(echo "$RESPONSE" | jq -r '.time1 // empty')

          if [ -n "$HAS_TIME1" ]; then
            echo "âœ… æ°´ã‚„ã‚Šè¨˜éŒ²ã‚ã‚Šï¼ˆtime1: $HAS_TIME1ï¼‰"
          else
            echo "âŒ time1 ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼LINEã¸é€šçŸ¥ã—ã¾ã™ã€‚"
          fi

          echo "âœ… å‡¦ç†å®Œäº†"
